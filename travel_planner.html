<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trip Packing Checklist</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .content {
            padding: 30px;
        }

        .trip-details {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            border-left: 4px solid #4facfe;
        }

        .trip-details h3 {
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }

        .trip-details h3::before {
            content: "✈️";
            margin-right: 10px;
            font-size: 1.2em;
        }

        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .form-group {
            flex: 1;
            min-width: 200px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
        }

        .form-group input {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #4facfe;
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: #4facfe;
            color: white;
        }

        .btn-primary:hover {
            background: #369ef8;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #545b62;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #1e7e34;
            transform: translateY(-2px);
        }

        .checklist {
            background: white;
            border-radius: 10px;
            border: 2px solid #f0f0f0;
        }

        .category {
            border-bottom: 1px solid #f0f0f0;
        }

        .category:last-child {
            border-bottom: none;
        }

        .category-header {
            background: #f8f9fa;
            padding: 15px 20px;
            font-weight: 600;
            color: #333;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .category-items {
            padding: 10px 20px;
        }

        .checklist-item {
            display: flex;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
            transition: background-color 0.2s;
            flex-wrap: wrap;
            gap: 8px;
        }

        .checklist-item:last-child {
            border-bottom: none;
        }

        .checklist-item:hover {
            background-color: #f8f9fa;
        }

        .checklist-item.completed {
            opacity: 0.6;
        }

        .checklist-item.completed .item-text {
            text-decoration: line-through;
        }

        .checklist-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 15px;
            cursor: pointer;
            accent-color: #4facfe;
        }

        .item-text {
            flex: 1;
            font-size: 16px;
            padding: 5px;
            border: none;
            background: transparent;
            cursor: text;
        }

        .item-text:focus {
            outline: 2px solid #4facfe;
            border-radius: 4px;
        }

        .item-quantity {
            font-weight: 600;
            color: #4facfe;
            margin-left: 8px;
            font-size: 14px;
        }

        .multiplier-controls {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-left: 10px;
        }

        .multiplier-input {
            width: 40px;
            padding: 2px 4px;
            border: 1px solid #ddd;
            border-radius: 3px;
            font-size: 12px;
            text-align: center;
        }

        .multiplier-label {
            font-size: 11px;
            color: #666;
        }

        .multiplier-toggle {
            font-size: 12px;
            padding: 2px 6px;
            border: 1px solid #4facfe;
            background: white;
            color: #4facfe;
            border-radius: 3px;
            cursor: pointer;
        }

        .multiplier-toggle:hover {
            background: #4facfe;
            color: white;
        }

        .item-actions {
            display: flex;
            gap: 5px;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .checklist-item:hover .item-actions {
            opacity: 1;
        }

        .btn-small {
            padding: 5px 8px;
            font-size: 12px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .add-item {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .add-item input {
            flex: 1;
            padding: 8px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 14px;
        }

        .add-item input:focus {
            outline: none;
            border-color: #4facfe;
        }

        .stats {
            display: flex;
            justify-content: space-between;
            background: #e3f2fd;
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .stat {
            text-align: center;
        }

        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #1976d2;
        }

        .stat-label {
            font-size: 12px;
            color: #666;
            text-transform: uppercase;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin: 15px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4facfe, #00f2fe);
            transition: width 0.3s ease;
        }

        @media (max-width: 600px) {
            .form-row {
                flex-direction: column;
            }
            
            .controls {
                flex-direction: column;
            }
            
            .stats {
                flex-direction: column;
                text-align: center;
            }
            
            .checklist-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .multiplier-controls {
                align-self: stretch;
                justify-content: flex-start;
                flex-wrap: wrap;
            }
            
            .item-actions {
                align-self: flex-end;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>✈️ Trip Packing Checklist</h1>
            <p>Never forget anything important again!</p>
        </div>
        
        <div class="content">
            <div class="trip-details">
                <h3>Trip Details</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="startDate">Start Date:</label>
                        <input type="date" id="startDate">
                    </div>
                    <div class="form-group">
                        <label for="tripDays">Number of Days:</label>
                        <input type="number" id="tripDays" min="1" max="365" value="2">
                    </div>
                </div>
                <div id="tripSummary" class="trip-summary"></div>
            </div>

            <div class="controls">
                <button class="btn btn-primary" onclick="saveList()">
                    💾 Save List
                </button>
                <button class="btn btn-secondary" onclick="loadList()">
                    📂 Load List
                </button>
                <button class="btn btn-success" onclick="addCategory()">
                    ➕ Add Category
                </button>
            </div>

            <div class="stats">
                <div class="stat">
                    <div class="stat-number" id="totalItems">0</div>
                    <div class="stat-label">Total Items</div>
                </div>
                <div class="stat">
                    <div class="stat-number" id="completedItems">0</div>
                    <div class="stat-label">Packed</div>
                </div>
                <div class="stat">
                    <div class="stat-number" id="remainingItems">0</div>
                    <div class="stat-label">Remaining</div>
                </div>
            </div>

            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>

            <div class="checklist" id="checklist"></div>
        </div>
    </div>

    <script>
        // In-memory storage for the checklist data
        let checklistData = {
            "Clothing": [
                { text: "Underwear", completed: false, multiplier: { perDay: 1, extra: 2 } },
                { text: "Socks", completed: false, multiplier: { perDay: 1, extra: 2 } },
                { text: "Shirts/tops", completed: false, multiplier: { perDay: 1, extra: 1 } },
                { text: "Pants/shorts", completed: false, multiplier: { perDay: 1, extra: 0 } },
                { text: "Pajamas", completed: false },
                { text: "Weather-appropriate outerwear", completed: false },
                { text: "Comfortable walking shoes", completed: false },
                { text: "Dress shoes (if needed)", completed: false }
            ],
            "Toiletries": [
                { text: "Toothbrush and toothpaste", completed: false },
                { text: "Shampoo and conditioner", completed: false },
                { text: "Body wash/soap", completed: false },
                { text: "Deodorant", completed: false },
                { text: "Razor and shaving cream", completed: false },
                { text: "Medications", completed: false, multiplier: { perDay: 1, extra: 2 } },
                { text: "Sunscreen", completed: false },
                { text: "Face wash and moisturizer", completed: false }
            ],
            "Electronics": [
                { text: "Phone charger", completed: false },
                { text: "Camera and charger", completed: false },
                { text: "Laptop/tablet and charger", completed: false },
                { text: "Power bank", completed: false },
                { text: "Headphones", completed: false },
                { text: "Travel adapter (if international)", completed: false },
                { text: "Cables and dongles", completed: false }
            ],
            "Documents": [
                { text: "Passport/ID", completed: false },
                { text: "Travel tickets", completed: false },
                { text: "Hotel confirmations", completed: false },
                { text: "Travel insurance documents", completed: false },
                { text: "Emergency contact information", completed: false },
                { text: "Copies of important documents", completed: false },
                { text: "Credit cards and cash", completed: false }
            ],
            "Essentials": [
                { text: "Luggage/suitcase", completed: false },
                { text: "Day pack/purse", completed: false },
                { text: "Snacks for travel", completed: false },
                { text: "Water bottle", completed: false },
                { text: "Entertainment (books, games)", completed: false },
                { text: "First aid kit", completed: false },
                { text: "Hand sanitizer", completed: false },
                { text: "Tissues", completed: false }
            ]
        };

        let savedData = {};

        function initializeDates() {
            const today = new Date();
            const startDateInput = document.getElementById('startDate');
            startDateInput.value = today.toISOString().split('T')[0];
            updateTripSummary();
        }

        function updateTripSummary() {
            const startDateInput = document.getElementById('startDate');
            const tripDaysInput = document.getElementById('tripDays');
            const startDate = startDateInput.value;
            const tripDays = parseInt(tripDaysInput.value);
            
            // Validate inputs
            if (!tripDays || tripDays < 1) {
                tripDaysInput.value = 1;
                return;
            }
            
            if (tripDays > 365) {
                tripDaysInput.value = 365;
                return;
            }
            
            if (startDate && tripDays) {
                try {
                    // Parse date components to avoid timezone issues
                    const [year, month, day] = startDate.split('-').map(num => parseInt(num));
                    const start = new Date(year, month - 1, day); // month is 0-based
                    const end = new Date(year, month - 1, day + tripDays - 1);
                    
                    // Check if dates are valid
                    if (isNaN(start.getTime()) || isNaN(end.getTime())) {
                        document.getElementById('tripSummary').innerHTML = '<p style="color: red;">Invalid date selected</p>';
                        return;
                    }
                    
                    const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                    const startFormatted = start.toLocaleDateString('en-US', options);
                    const endFormatted = end.toLocaleDateString('en-US', options);
                    
                    document.getElementById('tripSummary').innerHTML = `
                        <p><strong>Trip Duration:</strong> ${startFormatted} to ${endFormatted} (${tripDays} day${tripDays === 1 ? '' : 's'})</p>
                    `;
                    
                    // Update quantities when trip duration changes
                    updateStats();
                } catch (error) {
                    document.getElementById('tripSummary').innerHTML = '<p style="color: red;">Error calculating trip dates</p>';
                    console.error('Date calculation error:', error);
                }
            }
        }

        function renderChecklist() {
            const checklist = document.getElementById('checklist');
            checklist.innerHTML = '';

            Object.entries(checklistData).forEach(([category, items]) => {
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'category';
                
                const categoryHeader = document.createElement('div');
                categoryHeader.className = 'category-header';
                
                const categorySpan = document.createElement('span');
                if (category === 'Clothing') {
                    categorySpan.innerHTML = `📋 ${category} <small style="font-weight: normal; color: #666;">(excludes travel day)</small>`;
                } else {
                    categorySpan.textContent = `📋 ${category}`;
                }
                
                const removeBtn = document.createElement('button');
                removeBtn.className = 'btn-small btn-danger';
                removeBtn.textContent = 'Remove Category';
                removeBtn.addEventListener('click', () => removeCategory(category));
                
                categoryHeader.appendChild(categorySpan);
                categoryHeader.appendChild(removeBtn);
                
                const categoryItems = document.createElement('div');
                categoryItems.className = 'category-items';
                
                items.forEach((item, index) => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'checklist-item';
                    if (item.completed) {
                        itemDiv.classList.add('completed');
                    }
                    
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.checked = item.completed;
                    checkbox.addEventListener('change', (e) => toggleItem(category, index, e.target.checked));
                    
                    const textInput = document.createElement('input');
                    textInput.type = 'text';
                    textInput.className = 'item-text';
                    textInput.value = item.text;
                    textInput.addEventListener('blur', (e) => updateItemText(category, index, e.target.value));
                    textInput.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') e.target.blur();
                    });
                    
                    itemDiv.appendChild(checkbox);
                    itemDiv.appendChild(textInput);
                    
                    // Add quantity display if item has multiplier
                    if (item.multiplier) {
                        const quantity = calculateQuantity(item, category);
                        const quantitySpan = document.createElement('span');
                        quantitySpan.className = 'item-quantity';
                        quantitySpan.textContent = `(${quantity} needed)`;
                        itemDiv.appendChild(quantitySpan);
                    }
                    
                    // Add multiplier controls
                    const multiplierDiv = document.createElement('div');
                    multiplierDiv.className = 'multiplier-controls';
                    
                    if (item.multiplier) {
                        const perDayLabel = document.createElement('span');
                        perDayLabel.className = 'multiplier-label';
                        perDayLabel.textContent = '/day:';
                        
                        const perDayInput = document.createElement('input');
                        perDayInput.type = 'number';
                        perDayInput.className = 'multiplier-input';
                        perDayInput.min = '0';
                        perDayInput.value = item.multiplier.perDay;
                        perDayInput.addEventListener('change', (e) => 
                            updateMultiplier(category, index, e.target.value, item.multiplier.extra)
                        );
                        
                        const extraLabel = document.createElement('span');
                        extraLabel.className = 'multiplier-label';
                        extraLabel.textContent = '+extra:';
                        
                        const extraInput = document.createElement('input');
                        extraInput.type = 'number';
                        extraInput.className = 'multiplier-input';
                        extraInput.min = '0';
                        extraInput.value = item.multiplier.extra;
                        extraInput.addEventListener('change', (e) => 
                            updateMultiplier(category, index, item.multiplier.perDay, e.target.value)
                        );
                        
                        multiplierDiv.appendChild(perDayLabel);
                        multiplierDiv.appendChild(perDayInput);
                        multiplierDiv.appendChild(extraLabel);
                        multiplierDiv.appendChild(extraInput);
                    }
                    
                    const toggleBtn = document.createElement('button');
                    toggleBtn.className = 'multiplier-toggle';
                    toggleBtn.textContent = item.multiplier ? '×' : '+×';
                    toggleBtn.title = item.multiplier ? 'Remove multiplier' : 'Add multiplier';
                    toggleBtn.addEventListener('click', () => toggleMultiplier(category, index));
                    
                    multiplierDiv.appendChild(toggleBtn);
                    itemDiv.appendChild(multiplierDiv);
                    
                    const actionsDiv = document.createElement('div');
                    actionsDiv.className = 'item-actions';
                    
                    const deleteBtn = document.createElement('button');
                    deleteBtn.className = 'btn-small btn-danger';
                    deleteBtn.textContent = '✕';
                    deleteBtn.addEventListener('click', () => removeItem(category, index));
                    
                    actionsDiv.appendChild(deleteBtn);
                    itemDiv.appendChild(actionsDiv);
                    categoryItems.appendChild(itemDiv);
                });
                
                const addItemDiv = document.createElement('div');
                addItemDiv.className = 'add-item';
                
                const addInput = document.createElement('input');
                addInput.type = 'text';
                addInput.placeholder = 'Add new item...';
                addInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') addItem(category, e.target);
                });
                
                const addBtn = document.createElement('button');
                addBtn.className = 'btn btn-primary';
                addBtn.textContent = 'Add';
                addBtn.addEventListener('click', () => addItem(category, addInput));
                
                addItemDiv.appendChild(addInput);
                addItemDiv.appendChild(addBtn);
                
                categoryDiv.appendChild(categoryHeader);
                categoryDiv.appendChild(categoryItems);
                categoryDiv.appendChild(addItemDiv);
                checklist.appendChild(categoryDiv);
            });
            
            updateStats();
        }

        // Utility function to sanitize text input
        function sanitizeText(text) {
            if (typeof text !== 'string') return '';
            return text.trim().replace(/[<>\"']/g, '');
        }

        // Calculate quantity needed for an item with multiplier
        function calculateQuantity(item, category) {
            if (!item.multiplier) return null;
            const tripDays = parseInt(document.getElementById('tripDays').value) || 2;
            const perDay = item.multiplier.perDay || 0;
            const extra = item.multiplier.extra || 0;
            
            // For clothing items, subtract 1 day since you wear clothes on travel day
            let effectiveDays = tripDays;
            if (category === 'Clothing') {
                effectiveDays = Math.max(0, tripDays - 1);
            }
            
            return (perDay * effectiveDays) + extra;
        }

        // Toggle multiplier for an item
        function toggleMultiplier(category, index) {
            const item = checklistData[category][index];
            if (item.multiplier) {
                delete item.multiplier;
            } else {
                item.multiplier = { perDay: 1, extra: 0 };
            }
            renderChecklist();
        }

        // Update multiplier values
        function updateMultiplier(category, index, perDay, extra) {
            const item = checklistData[category][index];
            if (item.multiplier) {
                item.multiplier.perDay = Math.max(0, parseInt(perDay) || 0);
                item.multiplier.extra = Math.max(0, parseInt(extra) || 0);
                renderChecklist();
            }
        }

        function toggleItem(category, index, isChecked) {
            if (checklistData[category] && checklistData[category][index]) {
                checklistData[category][index].completed = isChecked;
                renderChecklist();
            }
        }

        function updateItemText(category, index, newText) {
            if (checklistData[category] && checklistData[category][index]) {
                checklistData[category][index].text = sanitizeText(newText);
                updateStats();
            }
        }

        function addItem(category, input) {
            const text = sanitizeText(input.value);
            if (text && checklistData[category]) {
                const newItem = { 
                    text: text, 
                    completed: false 
                    // No multiplier by default - user can add it with the +× button
                };
                checklistData[category].push(newItem);
                input.value = '';
                renderChecklist();
            }
        }

        function removeItem(category, index) {
            if (checklistData[category] && checklistData[category][index]) {
                checklistData[category].splice(index, 1);
                renderChecklist();
            }
        }

        function addCategory() {
            const categoryName = prompt('Enter category name:');
            if (categoryName) {
                const trimmedName = sanitizeText(categoryName);
                if (trimmedName && !checklistData[trimmedName]) {
                    checklistData[trimmedName] = [];
                    renderChecklist();
                } else if (checklistData[trimmedName]) {
                    alert('Category already exists!');
                } else {
                    alert('Please enter a valid category name.');
                }
            }
        }

        function removeCategory(category) {
            if (confirm(`Are you sure you want to remove the "${category}" category?`)) {
                delete checklistData[category];
                renderChecklist();
            }
        }

        function updateStats() {
            let total = 0;
            let completed = 0;
            
            Object.values(checklistData).forEach(items => {
                if (Array.isArray(items)) {
                    items.forEach(item => {
                        if (item && typeof item === 'object') {
                            total++;
                            if (item.completed) {
                                completed++;
                            }
                        }
                    });
                }
            });
            
            const remaining = total - completed;
            const progressPercent = total > 0 ? Math.round((completed / total) * 100) : 0;
            
            document.getElementById('totalItems').textContent = total;
            document.getElementById('completedItems').textContent = completed;
            document.getElementById('remainingItems').textContent = remaining;
            document.getElementById('progressFill').style.width = progressPercent + '%';
        }

        function saveList() {
            const listName = prompt('Enter a name for this list:', 'My Packing List');
            if (listName) {
                const trimmedName = sanitizeText(listName);
                if (trimmedName) {
                    try {
                        savedData[trimmedName] = {
                            checklist: JSON.parse(JSON.stringify(checklistData)),
                            startDate: document.getElementById('startDate').value,
                            tripDays: document.getElementById('tripDays').value,
                            savedDate: new Date().toISOString()
                        };
                        alert(`List "${trimmedName}" saved successfully!`);
                    } catch (error) {
                        alert('Error saving list. Please try again.');
                        console.error('Save error:', error);
                    }
                } else {
                    alert('Please enter a valid list name.');
                }
            }
        }

        function loadList() {
            const savedLists = Object.keys(savedData);
            if (savedLists.length === 0) {
                alert('No saved lists found. Please save a list first.');
                return;
            }
            
            let listOptions = 'Choose a list to load:\n\n';
            savedLists.forEach((name, index) => {
                const saveDate = savedData[name].savedDate ? 
                    new Date(savedData[name].savedDate).toLocaleDateString() : 
                    'Unknown date';
                listOptions += `${index + 1}. ${name} (saved: ${saveDate})\n`;
            });
            
            const choice = prompt(listOptions + '\nEnter the number or name of the list:');
            if (choice) {
                let selectedList = null;
                
                // Try to parse as number first
                const choiceNum = parseInt(choice);
                if (!isNaN(choiceNum) && choiceNum >= 1 && choiceNum <= savedLists.length) {
                    selectedList = savedLists[choiceNum - 1];
                } else {
                    // Try to find by name
                    selectedList = savedLists.find(name => 
                        name.toLowerCase() === choice.toLowerCase()
                    );
                }
                
                if (selectedList && savedData[selectedList]) {
                    try {
                        checklistData = JSON.parse(JSON.stringify(savedData[selectedList].checklist));
                        document.getElementById('startDate').value = savedData[selectedList].startDate || '';
                        document.getElementById('tripDays').value = savedData[selectedList].tripDays || '2';
                        updateTripSummary();
                        renderChecklist();
                        alert(`List "${selectedList}" loaded successfully!`);
                    } catch (error) {
                        alert('Error loading list. The data may be corrupted.');
                        console.error('Load error:', error);
                    }
                } else {
                    alert('List not found. Please check the name or number.');
                }
            }
        }

        // Event listeners
        document.getElementById('startDate').addEventListener('change', updateTripSummary);
        document.getElementById('tripDays').addEventListener('change', updateTripSummary);

        // Initialize the app
        initializeDates();
        renderChecklist();
    </script>
</body>
</html>